<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Model comparison · BayesDensity.jl</title><meta name="title" content="Model comparison · BayesDensity.jl"/><meta property="og:title" content="Model comparison · BayesDensity.jl"/><meta property="twitter:title" content="Model comparison · BayesDensity.jl"/><meta name="description" content="Documentation for BayesDensity.jl."/><meta property="og:description" content="Documentation for BayesDensity.jl."/><meta property="twitter:description" content="Documentation for BayesDensity.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="BayesDensity.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">BayesDensity.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../density_estimation_primer/">A primer on Bayesian nonparametric density estimation</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/general_api/">General API</a></li><li><a class="tocitem" href="../../api/plotting_api/">Plotting API</a></li></ul></li><li><span class="tocitem">Methods</span><ul><li><a class="tocitem" href="../../methods/">Index</a></li><li><a class="tocitem" href="../../methods/BSplineMixture/">BSplineMixture</a></li><li><a class="tocitem" href="../../methods/HistSmoother/">HistSmoother</a></li><li><a class="tocitem" href="../../methods/PitmanYorMixture/">PitmanYorMixture</a></li><li><a class="tocitem" href="../../methods/FiniteGaussianMixture/">FiniteGaussianMixture</a></li><li><a class="tocitem" href="../../methods/RandomFiniteGaussianMixture/">RandomFiniteGaussianMixture</a></li><li><a class="tocitem" href="../../methods/RandomBernsteinPoly/">RandomBernsteinPoly</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../naive_bayes/">Naive Bayes</a></li><li class="is-active"><a class="tocitem" href>Model comparison</a><ul class="internal"><li><a class="tocitem" href="#A-real-data-example"><span>A real-data example</span></a></li></ul></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/add_new_models/">Implementing new Bayesian density estimators</a></li></ul></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Model comparison</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Model comparison</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/oskarhs/BayesDensity.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/oskarhs/BayesDensity.jl/blob/main/docs/src/examples/model_selection.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Model-comparison"><a class="docs-heading-anchor" href="#Model-comparison">Model comparison</a><a id="Model-comparison-1"></a><a class="docs-heading-anchor-permalink" href="#Model-comparison" title="Permalink"></a></h1><p>In this example notebook, we will show how <code>BayesDensity</code> can be used to investigate whether two random samples follow the same distribution.</p><p>Suppose that we observe two independent samples <span>$x_1, \ldots, x_n \sim f_1$</span> and <span>$y_1, \ldots, y_m \sim f_2$</span>. In many applications it is of interest to test whether both samples come from a common distribution <span>$f$</span> against the alternative that <span>$f_1 \neq f_2$</span>. Although this is a problem that can be tackled by frequentist methods, the Bayesian solution based on model selection, that we focus on here, provides a rather elegant alternative. Here, we proceed by constructing two competing models, one under which the data-generating density is constrained to be the same across both groups, and another where the densities are allowed to differ. To assess which model fits the data better, a popular approach is to use an estimate of out-of sample predictive performance, and to choose the model that performs better with respect to this criterion. A popular metric for Bayesian model comparison is the widely applicable information criterion <a href="https://en.wikipedia.org/wiki/Watanabe%E2%80%93Akaike_information_criterion">(WAIC)</a>, (<a href="../../references/#Watanabe2010WAIC">Watanabe, 2010</a>),</p><p class="math-container">\[\text{WAIC} = -2\sum_{i=1}^n \log \Big\{\frac{1}{S}\sum_{s=1}^S f^{(s)}(y_i)\Big\} + 2\sum_{i=1}^n \widehat{\mathbb{V}}\big[\log f(y_i)\big],\]</p><p>where <span>$f^{(s)}$</span> are samples from the posterior distribution of <span>$f$</span> and <span>$\widehat{\mathbb{V}}\big[\log f(y_i)\big]$</span> is the sample variance of <span>$\log f^{(s)}(y_i)$</span>. In particular, a smaller value of this criterion is indicative of better model fit.</p><h2 id="A-real-data-example"><a class="docs-heading-anchor" href="#A-real-data-example">A real-data example</a><a id="A-real-data-example-1"></a><a class="docs-heading-anchor-permalink" href="#A-real-data-example" title="Permalink"></a></h2><p>To illustrate how to use <code>BayesDensity</code> for model comparison in practice, we consider a dataset consisting of <span>$11130$</span> average hourly earnings from the Current Population Survey, collected in the year <span>$1998$</span>. This dataset also provides the sex of each respondent, allowing us to study differences in the male and female wage distributions. After a cursory look at this dataset, one quickly discovers that the male average wage is considerably higher than the female average. Another interesting question to explore is whether the distribution of female wages relative to the female mean wage differs from the distribution of male wages relative to their respective mean. In order to keep our analysis noninformative, we assign equal prior probabilities to the null hypothesis and the alternative.</p><p>To begin answering this question, we first need to load the dataset in question:</p><pre><code class="language-julia hljs">using DataFrames
using RDatasets

# Load dataset and extract average hourly earnings by sex:
wage_data = dataset(&quot;Ecdat&quot;, &quot;CPSch3&quot;)
male_wages = wage_data[wage_data.Sex .== &quot;male&quot;, :].AHE
female_wages = wage_data[wage_data.Sex .== &quot;female&quot;, :].AHE

# Find the male and female wages relative to their respective group averages:
male_rel_wages = male_wages / mean(male_wages)
female_rel_wages = female_wages / mean(female_wages)</code></pre><p>Next, we fit a <a href="../../methods/BSplineMixture/#BSplineMixture"><code>BSplineMixture</code></a> to the joint sample, and the male and female samples separately via variational inference:</p><pre><code class="language-julia hljs">using BayesDensityBSplineMixture
model_male = BSplineMixture(male_rel_wages; prior_global_rate=1e-4, bounds=(0.0, 3.5))
model_female = BSplineMixture(female_rel_wages; prior_global_rate=1e-4, bounds=(0.0, 3.5))
model_joint  = BSplineMixture(vcat(male_rel_wages, female_rel_wages); prior_global_rate=1e-4, bounds=(0.0, 3.5))

# Fit variational approximations:
male_viposterior, male_info = varinf(model_male)
female_viposterior, female_info = varinf(model_female)
joint_viposterior, joint_info = varinf(model_joint)</code></pre><p>To have a cursory look at whether or not the hypothesis that the two samples have the same distribution, we decided to plot the estimated posterior medians of the densities of the male and female relative wage distributions separately:</p><pre><code class="language-julia hljs">using CairoMakie
fig = Figure(size=(550, 380))
ax = Axis(fig[1,1], xlabel=&quot;Relative wage&quot;, ylabel=&quot;Density&quot;, xlabelsize=20, ylabelsize=20)
plot!(ax, male_viposterior, label=&quot;Male wages&quot;, ci=false, strokecolor=:blue, estimate=median)
plot!(ax, female_viposterior, label=&quot;Female wages&quot;, ci=false, strokecolor=:black, linestyle=:dash, estimate=median)
Legend(fig[1,2], ax, framevisible=false)
save(joinpath(&quot;src&quot;, &quot;assets&quot;, &quot;model_selection&quot;, &quot;relative_wages_by_sex.svg&quot;), fig)</code></pre><p><img src="../../assets/model_selection/relative_wages_by_sex.svg" alt="Model comparison"/></p><p>Based on the above display, it appears that the distribution of male wages is a bit more dispersed than the female distribution, which could indicate that the null hypothesis is false in this case, especially given the fact that the sample sizes involved are quite large in this case.</p><p>To carry out the formal Bayesian analysis of this question, we need to compute the <span>$\text{WAIC}$</span> under both model specifications. We start by writing a funtion for computing the WAIC of each model:</p><pre><code class="language-julia hljs">function compute_waic(ps::PosteriorSamples)
    # Note that the original data to which a `BSplineMixture`
    # object was fit is stored under `bsm.data.x`.
    logpdfs = log.(pdf(ps, model(ps).data.x))
    lppd = sum(log.(mapslices(mean, exp.(logpdfs); dims=2)))
    effpar_male = sum(vec(mapslices(var, logpdfs; dims=2)))
    return -2 * (lppd - effpar_male)
end</code></pre><p>Next, we compute the WAIC of the three models using the above function. Note that under the unconstrained model specification, the WAIC decomposes nicely into the sum of the WAICs of both models evaluated on their respective samples since both the priors and the likelihoods are independent in this case.</p><pre><code class="language-julia hljs">waic_male = compute_waic(sample(rng, male_viposterior, 10_000))
waic_female = compute_waic(sample(rng, female_viposterior, 10_000))
waic_joint = compute_waic(sample(rng, joint_viposterior, 10_000))
waic_separate = waic_male + waic_female

waic_joint, waic_separate</code></pre><p>After running the above code snippet, we obtain a WAIC of <span>$11036$</span> for the constrained model and a <span>$10968$</span> for the unconstrained one, strongly favoring the latter model. The results obtained here indicate that the two samples indeed follow different distributions.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../naive_bayes/">« Naive Bayes</a><a class="docs-footer-nextpage" href="../../tutorials/add_new_models/">Implementing new Bayesian density estimators »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 11 February 2026 20:01">Wednesday 11 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
